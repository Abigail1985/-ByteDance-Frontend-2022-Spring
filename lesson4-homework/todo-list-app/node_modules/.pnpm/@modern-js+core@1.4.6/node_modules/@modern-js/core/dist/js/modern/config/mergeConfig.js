import mergeWith from 'lodash.mergewith';
import { isFunction } from '@modern-js/utils';

/**
 * merge configuration from  modern.config.js and plugins.
 *
 * @param configs - Configuration from modern.config.ts or plugin's config hook.
 * @returns - normalized user config.
 */
export const mergeConfig = configs => mergeWith({}, ...configs, (target, source) => {
  if (Array.isArray(target)) {
    if (Array.isArray(source)) {
      return [...target, ...source];
    } else {
      return typeof source !== 'undefined' ? [...target, source] : target;
    }
  } else if (isFunction(source)) {
    return typeof target !== 'undefined' ? [target, source] : [source];
  }

  return undefined;
});