"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _server = require("react-dom/server");

var _hook = require("./hook");

var _jsxRuntime = require("react/jsx-runtime");

// todo: SSRContext
const prefetch = async (App, context) => (0, _hook.run)(context.ssrContext.request.headers, async () => {
  var _context$store;

  (0, _server.renderToStaticMarkup)( /*#__PURE__*/(0, _jsxRuntime.jsx)(App, {
    context: context
  }));

  if (!context.loaderManager.hasPendingLoaders()) {
    return {
      i18nData: context.__i18nData__
    };
  }

  const loadersData = await context.loaderManager.awaitPendingLoaders();
  return {
    loadersData,
    i18nData: context.__i18nData__,
    // todo: move to plugin state
    storeState: context === null || context === void 0 ? void 0 : (_context$store = context.store) === null || _context$store === void 0 ? void 0 : _context$store.getState()
  };
});

var _default = prefetch;
exports.default = _default;