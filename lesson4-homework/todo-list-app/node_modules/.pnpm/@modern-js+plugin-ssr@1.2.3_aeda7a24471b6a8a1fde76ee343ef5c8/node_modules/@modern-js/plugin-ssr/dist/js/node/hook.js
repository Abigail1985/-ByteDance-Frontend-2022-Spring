"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.useHeaders = exports.run = void 0;

var _async_hooks = _interopRequireDefault(require("async_hooks"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const storage = _async_hooks.default !== null && _async_hooks.default !== void 0 && _async_hooks.default.AsyncLocalStorage ? new _async_hooks.default.AsyncLocalStorage() : null;

const run = (headers, next) => storage.run(headers, next);

exports.run = run;

const useHeaders = () => {
  if (!storage) {
    throw new Error(`Unable to use async_hook, please confirm the node version
      `);
  }

  const headers = storage.getStore();

  if (!headers) {
    throw new Error(`Can't call useHeaders out of scope, it should be placed on top of the function`);
  }

  return headers;
};

exports.useHeaders = useHeaders;