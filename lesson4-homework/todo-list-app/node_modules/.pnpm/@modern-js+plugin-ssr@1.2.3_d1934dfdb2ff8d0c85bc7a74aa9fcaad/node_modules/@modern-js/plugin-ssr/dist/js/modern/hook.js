import ah from 'async_hooks';
const storage = ah !== null && ah !== void 0 && ah.AsyncLocalStorage ? new ah.AsyncLocalStorage() : null;
export const run = (headers, next) => storage.run(headers, next);
export const useHeaders = () => {
  if (!storage) {
    throw new Error(`Unable to use async_hook, please confirm the node version
      `);
  }

  const headers = storage.getStore();

  if (!headers) {
    throw new Error(`Can't call useHeaders out of scope, it should be placed on top of the function`);
  }

  return headers;
};