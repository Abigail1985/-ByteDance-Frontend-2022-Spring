"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.getPackageManager = getPackageManager;

var _os = _interopRequireDefault(require("os"));

var _path = _interopRequireDefault(require("path"));

var _fsExtra = _interopRequireDefault(require("fs-extra"));

var _nodeEnv = require("./nodeEnv");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const MAX_TIMES = 5;

async function getPackageManager(cwd = process.cwd()) {
  let appDirectory = cwd;
  let times = 0;

  while (_os.default.homedir() !== appDirectory && times < MAX_TIMES) {
    times++;

    if (_fsExtra.default.existsSync(_path.default.resolve(appDirectory, 'pnpm-lock.yaml'))) {
      return 'pnpm';
    }

    if (_fsExtra.default.existsSync(_path.default.resolve(appDirectory, 'yarn.lock'))) {
      return 'yarn';
    }

    if (_fsExtra.default.existsSync(_path.default.resolve(appDirectory, 'package-lock.json'))) {
      return 'npm';
    }

    appDirectory = _path.default.join(appDirectory, '..');
  }

  if (await (0, _nodeEnv.canUsePnpm)()) {
    return 'pnpm';
  }

  if (await (0, _nodeEnv.canUseYarn)()) {
    return 'yarn';
  }

  return 'npm';
}