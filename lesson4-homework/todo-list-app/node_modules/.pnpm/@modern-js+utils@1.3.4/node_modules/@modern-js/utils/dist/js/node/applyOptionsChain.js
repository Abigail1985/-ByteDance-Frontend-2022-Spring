"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.applyOptionsChain = void 0;

var _index = require("./index");

// eslint-disable-next-line import/no-useless-path-segments
const applyOptionsChain = (defaults, options, utils, mergeFn = Object.assign) => {
  if (!options) {
    return defaults;
  }

  if ((0, _index.isPlainObject)(options)) {
    return mergeFn(defaults, options);
  } else if ((0, _index.isFunction)(options)) {
    const ret = options(defaults, utils);

    if (ret) {
      if (!(0, _index.isPlainObject)(ret)) {
        _index.logger.warn(`${options.name}: Function should mutate the config and return nothing, Or return a cloned or merged version of config object.`);
      }

      return ret;
    }
  } else if (Array.isArray(options)) {
    return options.reduce((memo, cur) => applyOptionsChain(memo, cur, utils, mergeFn), defaults);
  } else {
    throw new Error(`applyOptionsChain error:\ndefault options is: ${JSON.stringify(defaults)}`);
  }

  return defaults;
};

exports.applyOptionsChain = applyOptionsChain;