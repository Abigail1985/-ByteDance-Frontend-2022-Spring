"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.start = void 0;

var _utils = require("@modern-js/utils");

var _core = require("@modern-js/core");

var _prodServer = _interopRequireDefault(require("@modern-js/prod-server"));

var _printInstructions = require("../utils/printInstructions");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const start = async () => {
  /* eslint-disable react-hooks/rules-of-hooks */
  const appContext = (0, _core.useAppContext)();
  const userConfig = (0, _core.useResolvedConfigContext)();
  /* eslint-enable react-hooks/rules-of-hooks */

  const {
    appDirectory,
    port
  } = appContext;

  _utils.logger.log(_utils.chalk.cyan(`Starting the modern server...`));

  const app = await (0, _prodServer.default)({
    pwd: appDirectory,
    config: userConfig,
    plugins: appContext.plugins.filter(p => p.server).map(p => p.server)
  });
  app.listen(port, async err => {
    if (err) {
      throw err;
    }

    await (0, _printInstructions.printInstructions)(appContext, userConfig);
  });
};

exports.start = start;