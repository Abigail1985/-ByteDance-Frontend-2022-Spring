"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.render = void 0;

var _runtimeCore = require("@modern-js/runtime-core");

var _prerender = require("../react/prerender");

var _hook = require("../hook");

var _entry = _interopRequireDefault(require("./entry"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const render = async (ctx, _ = process.cwd(), App) => {
  const {
    entryName,
    template: templateHTML
  } = ctx.ssrContext; // const templateHTML = path.join(pwd, entryPath);

  return (0, _hook.run)(ctx.ssrContext.request.headers, async () => {
    const entry = new _entry.default({
      name: entryName,
      App,
      template: templateHTML
    });
    const html = await entry.renderToHtml(ctx);

    const cacheConfig = _prerender.PreRender.config();

    if (cacheConfig) {
      // eslint-disable-next-line require-atomic-updates
      ctx.ssrContext.cacheConfig = cacheConfig;
    }

    return html;
  });
};

exports.render = render;