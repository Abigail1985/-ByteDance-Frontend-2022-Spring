"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.getSourceIncludes = void 0;

var _path = _interopRequireDefault(require("path"));

var _utils = require("@modern-js/utils");

var _memoize = require("./memoize");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const shouldIncludePackage = (p, include) => include.some(i => i instanceof RegExp ? i.test(p.name) : p.name === i);

const getSourceIncludes = (0, _memoize.memoize)((appDirectory, config) => {
  const {
    source
  } = config;
  const include = (source === null || source === void 0 ? void 0 : source.include) || [];
  const root = (0, _utils.findMonorepoRoot)(appDirectory);

  if (!root) {
    return include;
  }

  const packages = (0, _utils.getMonorepoPackages)(root);
  const modernjsMonorepo = (0, _utils.isModernjsMonorepo)(root);
  const paths = packages.filter(p => modernjsMonorepo && p.path.startsWith(_path.default.join(root, 'features')) || shouldIncludePackage(p, include)).map(p => p.path);
  return [...paths, ...include];
});
exports.getSourceIncludes = getSourceIncludes;